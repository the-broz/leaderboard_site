<!-- GAME PAGE FOR: TUNNEL GLIDER !-->
<head>
          <link href="/static/css/gamepage.css" rel="stylesheet" type="text/css" />
          <title class="title">Tunnel Glider - Leaderboard</title>
          </head>
<body>
          <div class="topnav">
          <a href="/">Home</a>  
        <a href="signup">Signup</a>  
         <a href="https://forms.gle/zCXXvJF8WtBic1cJA">Submit Score</a>
                    <a class="leftside">Signup</a>
</div>
          
          <div class="leaderboard">
                    <div class="catergories">
                              <button id="normal" class="active">Normal</button>
                              <button id="turbine" class="inactive">Turbine</button>
                              <button id="chaos" class="inactive">Chaos</button>
                              </div>
                    <h1 style="color: white;">Tunnel Glider</h1>
                    <div class="mods"><p class="moderators" style="color: white;">Leaderboard Moderator(s):</p><p style="color: white;"><span><img src="/static/badges/moderator.png" alt="supermod" class="mod"/></span> thebroz</p><p style="color: white;"><span><img src="/static/badges/moderator.png" alt="supermod" class="mod"/></span> Greg</p><p style="color: white;"><span><img src="/static/badges/moderator.png" alt="supermod" class="mod"/></span> Jack</p>
                    </div>
                    
                    <button class="submit" onclick="location.href='https://forms.gle/zCXXvJF8WtBic1cJA';">Submit Score</button>
                    
                    
                 <div class="placements"></div>
                   
                    <p class="extra">It may take up to 7 days for your score to be reviewed and approved. Updates every 10s.</p>
          </div>
               <script type="module">
                     var CAT = "normal"
                     var oldData = [];
                     function addCommas(nStr)
{
    nStr += '';
    var x = nStr.split('.');
    var x1 = x[0];
    var x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
    }
    return x1 + x2;
}
                     
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-analytics.js";
                     import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";


  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCQEOWjysLQNGwDemk-jp4k3cWdAuitHZw",
    authDomain: "leaderboards-site.firebaseapp.com",
    databaseURL: "https://leaderboards-site-default-rtdb.firebaseio.com",
    projectId: "leaderboards-site",
    storageBucket: "leaderboards-site.appspot.com",
    messagingSenderId: "943539476503",
    appId: "1:943539476503:web:82e4398689311b3fec2452",
    measurementId: "G-D16RW8RJYM"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
                     const database = getDatabase();
                     function updateBoard(){
                               document.getElementsByClassName('placements')[0].innerHTML = "";
                     const starCountRef = ref(database, 'games/' + 'tunnel' + '/' + CAT);
onValue(starCountRef, (snapshot) => {
  const data = snapshot.val();
           document.getElementsByClassName('placements')[0].innerHTML = "";
     let sortable = [];
for (var score in data) {
    sortable.push([score, data[score]]);
}

sortable.sort(function(a, b) {
    return a[1] - b[1];
});
          sortable.reverse();
console.log(sortable);
          if (sortable == oldData){
          return
          }else{
          oldData = sortable
          }
          if (sortable == null || sortable.length == 0){
          //We have no scores
                const newScore = document.createElement("p");
                   
                              newScore.innerHTML = "No scores available."
                              console.log("there are none!");
                               newScore.className = "placement"
                              done = true;
                               document.getElementsByClassName("placements")[0].appendChild(newScore);
                             
                        
          }
          for (var i=0; i < sortable.length; i++){
                    var done = false;
                    console.log("working on: "+i)
          const newScore = document.createElement("p");
                    if (i + 1 == 1){
                              newScore.innerHTML = "[<span class=\"first\">1st</span>] "+sortable[i][0]+" - "+addCommas(sortable[i][1])+" km"
                              console.log("is first!");
                               newScore.className = "placement"
                              done = true;
                               document.getElementsByClassName("placements")[0].appendChild(newScore);
                              newScore.style = "animation: scoreAdd; animation-duration: "+(.5+i)+"s; animation-iteration-count: 1;";
                    }
                    if (i + 1 == 2){
                              newScore.innerHTML = "[<span class=\"sec\">2nd</span>] "+sortable[i][0]+" - "+addCommas(sortable[i][1])+" km"
                              console.log("is sec!");
                               newScore.className = "placement"
                              done = true;
                              
                               document.getElementsByClassName("placements")[0].appendChild(newScore);
                               newScore.style = "animation: scoreAdd; animation-duration: "+(.5+i)+"s; animation-iteration-count: 1;";
                    }
                    if (i + 1 == 3){
                              newScore.innerHTML = "[<span class=\"third\">3rd</span>] "+sortable[i][0]+" - "+addCommas(sortable[i][1])+" km"
                              console.log("is third!");
                               newScore.className = "placement"
                              done = true;
                               document.getElementsByClassName("placements")[0].appendChild(newScore);
                           newScore.style = "animation: scoreAdd; animation-duration: "+(.5+i)+"s; animation-iteration-count: 1;";    
                    }
                   if (done === false){
                             done = true;
                             if (sortable[i][1] < 0) {
                                       newScore.innerHTML = "<span class=\"other\">[REMOVED]</span> "+sortable[i][0]+" - SCORE REMOVED"
                             }else{
                              newScore.innerHTML = "<span class=\"other\">["+(i + 1)+"th]</span> "+sortable[i][0]+" - "+addCommas(sortable[i][1])+" pts"
                             }
                    newScore.className = "placement"
                    console.log("not first or second or third!");
                   document.getElementsByClassName("placements")[0].appendChild(newScore);
                         
                    newScore.style = "animation: scoreAdd; animation-duration: "+(.5+i)+"s; animation-iteration-count: 1;";
                   }
                    
                    
          }
          
});
                     }
                     var CAT1 = document.getElementById("normal")
                  
                     var CAT2 = document.getElementById("turbine")
                     var CAT3 = document.getElementById("chaos")
                     
                     
                     CAT1.addEventListener('click',function(e){
                     e.preventDefault();
                               CAT = "normal"
                               CAT1.className = "active"
                               CAT3.className = "inactive"
                               document.title = "Tunnel Glider - Normal Leaderboard"
                               CAT2.className = "inactive"
                               updateBoard();
                     });
                     CAT2.addEventListener('click',function(e){
                     e.preventDefault();
                               CAT = "turbine"
                               CAT2.className = "active"
                               CAT3.className = "inactive"
                               document.title = "Tunnel Glider - Turbine Leaderboard"
                               CAT1.className = "inactive"
                               updateBoard();
                     });
                         CAT3.addEventListener('click',function(e){
                     e.preventDefault();
                               CAT = "chaos"
                               CAT2.className = "inactive"
                                   CAT3.className = "active"
                               document.title = "Tunnel Glider - Chaos Leaderboard"
                               CAT1.className = "inactive"
                               updateBoard();
                     });
                     
updateBoard();
setInterval(function(){
updateBoard();
},30000);
                     
</script>    
</body>